{{> layout/header }}
<body id="page-top">
<div id="wrapper">
    {{> layout/sidebar }}
    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            {{> layout/topbar }}
            <!-- 레이아웃 작업 부분 -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-between mb-4">
                    <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
<!--                    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i-->
<!--                            class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>-->
                </div>

                <!-- Content Row -->
                <div class="row">

                    <!-- Earnings (Monthly) Card Example -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-primary shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                            전체 회원가입 수</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{dashboardStat.totalUsers}} 건</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-users fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Earnings (Monthly) Card Example -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-success shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                            금일 가입자 건수</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{dashboardStat.todayUsers}} 건</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-user-plus fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Earnings (Monthly) Card Example -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-info shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                            금일 문의 수
                                        </div>
                                        <div class="row no-gutters align-items-center">
                                            <div class="col-auto">
                                                <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{dashboardStat.todayInquiries}} 건</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-comments fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Requests Card Example -->
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card border-left-warning shadow h-100 py-2">
                            <div class="card-body">
                                <div class="row no-gutters align-items-center">
                                    <div class="col mr-2">
                                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                            문의 대기 건 수</div>
                                        <div class="h5 mb-0 font-weight-bold text-gray-800">{{dashboardStat.pendingInquiries}} 건</div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-hourglass-half fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Row -->

                <div class="row">

                    <!-- Area Chart -->
                    <div class="col-xl-8 col-lg-7">
                        <div class="card shadow mb-4">
                            <!-- Card Header -->
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 id="chartTitle" class="m-0 font-weight-bold text-primary">
                                    {{year}}년 월별 문의 현황
                                </h6>

                                <select id="yearSelect" class="form-select form-select-sm w-auto border-0 shadow-none">
                                    <option value="2023">2023</option>
                                    <option value="2024">2024</option>
                                    <option value="2025" selected>2025</option>
                                </select>

                            </div>

                            <!-- Card Body -->
                            <div class="card-body">
                                <div class="chart-area">
                                    <canvas id="myAreaChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pie Chart -->
                    <div class="col-xl-4 col-lg-5">
                        <div class="card shadow mb-4">
                            <!-- Card Header - Dropdown -->
                            <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">카테고리별 질문 통계&nbsp;&nbsp;&nbsp;&nbsp;[Total:  {{questionCountAll}}건]</h6>
                            </div>
                            <!-- Card Body -->
                            <div class="card-body">
                                <div class="chart-pie pt-4 pb-2">
                                    <canvas id="myPieChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Content Row -->
            </div>
        </div>

        {{> layout/footer }}
    </div>
</div>

<script src="/bootstrap/vendor/chart.js/Chart.min.js"></script>
<script src="/bootstrap/js/demo/chart-area.js"></script>
<!--<script src="/bootstrap/js/demo/chart-pie-demo.js"></script>-->

<script>
    const donutLabels = [
    {{#donutChartStat}}
        "{{categoryName}}",
    {{/donutChartStat}}
    ];

    const donutData = [
    {{#donutChartStat}}
        {{questionCount}},
    {{/donutChartStat}}
    ];

    const pieCtx = document.getElementById("myPieChart");

    // 색상 세트
    const colors = ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'];

    // 차트 생성
    new Chart(pieCtx, {
        type: 'doughnut',
        data: {
            labels: donutLabels,
            datasets: [{
                data: donutData,
                backgroundColor: colors.slice(0, donutLabels.length),
                hoverOffset: 8,
            }],
        },
        options: {
              maintainAspectRatio: false,
              legend: {
                display: false
              },
              cutoutPercentage: 70,
            }
    });

    //커스텀 legend 생성
    const legendContainer = document.querySelector(".chart-pie").insertAdjacentHTML(
        'afterend',
        `
        <div id="categoryLegend" class="mt-3 text-center small">
            ${donutLabels.map((label, i) => `
                <span class="mr-3 d-inline-flex align-items-center">
                    <span class="legend-dot" style="background-color:${colors[i]};"></span>
                    ${label}
                </span>
            `).join('')}
        </div>
        `
    );
</script>

<style>
    .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 6px;
    }
</style>

</body>
</html>